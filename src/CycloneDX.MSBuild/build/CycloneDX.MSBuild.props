<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">

  <!--
    CycloneDX.MSBuild Configuration Properties

    This file defines MSBuild properties that control CycloneDX SBOM generation.
    Users can override these properties in their project files or Directory.Build.props.
  -->

  <PropertyGroup Label="CycloneDX Core Settings">

    <!--
      Enable/Disable SBOM generation
      Set to 'false' to disable SBOM generation for specific projects
    -->
    <GenerateCycloneDxSbom Condition="'$(GenerateCycloneDxSbom)' == ''">true</GenerateCycloneDxSbom>

    <!--
      Continue build on SBOM generation failure
      Set to 'false' to fail the build if SBOM generation fails
    -->
    <CycloneDxContinueOnError Condition="'$(CycloneDxContinueOnError)' == ''">true</CycloneDxContinueOnError>

  </PropertyGroup>

  <PropertyGroup Label="CycloneDX Output Configuration">

    <!--
      Output format: json, xml
      Default: json
    -->
    <CycloneDxOutputFormat Condition="'$(CycloneDxOutputFormat)' == ''">json</CycloneDxOutputFormat>

    <!--
      Output directory for generated SBOM
      Default: $(OutputPath) - set at build time in .targets file
      Users can override this in their project file
    -->
    <!-- CycloneDxOutputDirectory default is set in .targets, not here -->

    <!--
      Output filename (without extension)
      Default: sbom (results in sbom.json or sbom.xml)
    -->
    <CycloneDxOutputFilename Condition="'$(CycloneDxOutputFilename)' == ''">sbom</CycloneDxOutputFilename>

  </PropertyGroup>

  <PropertyGroup Label="CycloneDX Tool Configuration">

    <!--
      CycloneDX tool version to use
      This should match a valid NuGet package version of 'CycloneDX'
    -->
    <CycloneDxToolVersion Condition="'$(CycloneDxToolVersion)' == ''">5.5.0</CycloneDxToolVersion>

  </PropertyGroup>

  <PropertyGroup Label="CycloneDX Advanced Options">

    <!--
      Enable automatic metadata generation from assembly/package properties
      Set to 'false' to disable automatic metadata extraction
      Default: true
    -->
    <CycloneDxGenerateMetadata Condition="'$(CycloneDxGenerateMetadata)' == ''">true</CycloneDxGenerateMetadata>

    <!--
      Exclude development dependencies from SBOM
      Default: false
    -->
    <CycloneDxExcludeDev Condition="'$(CycloneDxExcludeDev)' == ''">false</CycloneDxExcludeDev>

    <!--
      Exclude test projects from SBOM
      Default: false
    -->
    <CycloneDxExcludeTestProjects Condition="'$(CycloneDxExcludeTestProjects)' == ''">false</CycloneDxExcludeTestProjects>

    <!--
      Disable SBOM serial number generation
      Default: false (serial number is auto-generated)
    -->
    <CycloneDxDisableSerialNumber Condition="'$(CycloneDxDisableSerialNumber)' == ''">false</CycloneDxDisableSerialNumber>

    <!--
      Import metadata template path
      Optionally provide a metadata template which has project specific details
      Default: empty (no metadata import)
    -->
    <CycloneDxImportMetadataPath Condition="'$(CycloneDxImportMetadataPath)' == ''"></CycloneDxImportMetadataPath>

  </PropertyGroup>

  <PropertyGroup Label="CycloneDX License Resolution">

    <!--
      Enable GitHub license resolution
      Default: false
    -->
    <CycloneDxEnableGitHubLicenses Condition="'$(CycloneDxEnableGitHubLicenses)' == ''">false</CycloneDxEnableGitHubLicenses>

    <!--
      GitHub username for license resolution
      Leave empty to disable GitHub license lookups
    -->
    <CycloneDxGitHubUsername Condition="'$(CycloneDxGitHubUsername)' == ''"></CycloneDxGitHubUsername>

    <!--
      GitHub personal access token for license resolution
      Leave empty to use unauthenticated requests (rate limited)
    -->
    <CycloneDxGitHubToken Condition="'$(CycloneDxGitHubToken)' == ''"></CycloneDxGitHubToken>

  </PropertyGroup>

  <PropertyGroup Label="CycloneDX Internal Properties">

    <!--
      Internal: Full output path for SBOM file
      Constructed from directory, filename, and format
    -->
    <CycloneDxOutputPath Condition="'$(CycloneDxOutputFormat)' == 'json'">$(CycloneDxOutputDirectory)$(CycloneDxOutputFilename).json</CycloneDxOutputPath>
    <CycloneDxOutputPath Condition="'$(CycloneDxOutputFormat)' == 'xml'">$(CycloneDxOutputDirectory)$(CycloneDxOutputFilename).xml</CycloneDxOutputPath>
    <!-- Fallback: If output path is still unset, default to .json -->
    <CycloneDxOutputPath Condition="'$(CycloneDxOutputPath)' == ''">$(CycloneDxOutputDirectory)$(CycloneDxOutputFilename).json</CycloneDxOutputPath>

    <!--
      Internal: Flag to track if tool manifest exists
    -->
    <CycloneDxToolManifestPath>$(MSBuildProjectDirectory)/.config/dotnet-tools.json</CycloneDxToolManifestPath>

  </PropertyGroup>

</Project>
